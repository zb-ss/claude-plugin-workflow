#+TITLE: Feature: {{TITLE}}
#+AUTHOR: Claude Code Workflow
#+DATE: {{DATE}}
#+PROPERTY: WORKFLOW_ID {{WORKFLOW_ID}}
#+PROPERTY: WORKFLOW_TYPE feature
#+PROPERTY: STATUS active
#+PROPERTY: BRANCH {{BRANCH}}
#+PROPERTY: STATE_FILE {{STATE_FILE}}
#+PROPERTY: TESTS_ENABLED {{TESTS_ENABLED}}
#+PROPERTY: MODE {{MODE}}

* Overview
:PROPERTIES:
:CREATED_AT: {{TIMESTAMP}}
:UPDATED_AT: {{TIMESTAMP}}
:END:

** Description
{{DESCRIPTION}}

** Branch
- Branch: {{BRANCH}}
- Base: {{BASE_BRANCH}}

* Workflow Steps

** TODO Step 0: Planning
:PROPERTIES:
:AGENT: Plan
:STATUS: pending
:STARTED_AT:
:COMPLETED_AT:
:END:

*** Objectives
- [ ] Identify language/framework in use
- [ ] Explore codebase for existing patterns and architecture
- [ ] Verify architecture aligns with best practices
- [ ] Identify all files to create/modify
- [ ] Document dependencies and prerequisites
- [ ] Create detailed implementation steps
- [ ] Identify potential risks and edge cases
- [ ] Define input validation requirements
- [ ] Define i18n/translation requirements

*** Plan
#+BEGIN_SRC markdown
# Implementation Plan

(Planning agent will write the detailed plan here)

## Technology Stack
- Language: (PHP 8.x / Python 3.x / TypeScript / etc.)
- Framework: (Laravel / Symfony / Django / FastAPI / etc.)
- Frontend: (Vue 3 / React / Blade / Twig / etc.)
- Database: (MySQL / PostgreSQL / MongoDB / etc.)

## Architecture Review

### Existing Patterns Identified
(Document patterns found in codebase that should be followed)
- [ ] Repository pattern
- [ ] Service layer
- [ ] DTOs/Value Objects
- [ ] Event-driven
- [ ] Other: ___

### SOLID Compliance Check
- [ ] **S** - Single Responsibility: Each class has one reason to change
- [ ] **O** - Open/Closed: Open for extension, closed for modification
- [ ] **L** - Liskov Substitution: Subtypes substitutable for base types
- [ ] **I** - Interface Segregation: Many specific interfaces > one general
- [ ] **D** - Dependency Inversion: Depend on abstractions, not concretions

### Design Patterns to Apply
| Pattern | Where | Why |
|---------|-------|-----|
|         |       |     |

### Scalability Considerations
- [ ] Can handle increased load?
- [ ] Stateless where possible?
- [ ] Cacheable?
- [ ] Database queries optimized?

### Extensibility Points
- [ ] Where might this need to change in future?
- [ ] Are we using interfaces/abstractions appropriately?
- [ ] Configuration over hardcoding?

## Files to Modify

## Files to Create

## Implementation Steps
(Numbered steps following identified patterns)

## Input Validation Requirements
| Field | Type | Frontend Rules | Backend Rules | Sanitization |
|-------|------|----------------|---------------|--------------|
|       |      |                |               |              |

## Internationalization (i18n) Requirements
- [ ] Does this feature have user-facing text?
- [ ] Translation system identified: (Laravel __() / Vue $t() / Joomla Text::_() / etc.)
- [ ] New language keys needed:
  - KEY_NAME = "English text"

## Testing Strategy
- [ ] Unit tests for: ___
- [ ] Integration tests for: ___
- [ ] E2E tests for: ___
- [ ] Test framework: (PHPUnit / pytest / Jest / Vitest / etc.)

## Edge Cases to Handle

## Risks and Considerations
#+END_SRC

*** Notes
(Any additional notes from planning phase)

** TODO Step 1: Implementation
:PROPERTIES:
:AGENT: workflow:executor
:STATUS: pending
:STARTED_AT:
:COMPLETED_AT:
:DEPENDS_ON: Step 0
:END:

*** Objectives
- [ ] Implement all planned changes
- [ ] Follow existing code patterns
- [ ] No syntax errors
- [ ] Code compiles/runs

*** Changed Files
| File | Action | Description |
|------+--------+-------------|
|      |        |             |

*** Implementation Notes
#+BEGIN_SRC markdown
(Implementation notes and decisions will be recorded here)
#+END_SRC

** TODO Step 2: Code Review
:PROPERTIES:
:AGENT: workflow:reviewer
:STATUS: pending
:STARTED_AT:
:COMPLETED_AT:
:DEPENDS_ON: Step 1
:ITERATION: 0
:MAX_ITERATIONS: 3
:END:

*** Review Criteria
- [ ] Implementation matches plan
- [ ] Code quality and readability
- [ ] Error handling is appropriate
- [ ] Edge cases covered
- [ ] Follows project conventions
- [ ] No unnecessary complexity

*** Review Log
| Iteration | Verdict | Issues Found | Fixed |
|-----------+---------+--------------+-------|
|         1 |         |              |       |
|         2 |         |              |       |
|         3 |         |              |       |

*** Current Review Feedback
#+BEGIN_SRC markdown
(Review feedback will be written here - this gets passed back to implementation if failed)
#+END_SRC

** TODO Step 3: Input Validation Review
:PROPERTIES:
:AGENT: workflow:reviewer
:STATUS: pending
:STARTED_AT:
:COMPLETED_AT:
:DEPENDS_ON: Step 2
:END:

*** Validation Checklist
**** Frontend Validation
- [ ] All user inputs have client-side validation
- [ ] Required fields marked and enforced
- [ ] Format validation (email, phone, URL patterns)
- [ ] Length limits enforced (maxlength)
- [ ] Error messages are user-friendly

**** Backend Validation (CRITICAL)
- [ ] EVERY input re-validated server-side
- [ ] Type coercion explicit
- [ ] Whitelist validation preferred
- [ ] Foreign keys validated
- [ ] Arrays/objects have size limits

**** Sanitization
- [ ] HTML entities escaped for display
- [ ] SQL uses parameterized queries
- [ ] File paths validated (no traversal)

*** Validation Findings
| Location | Field | Issue | Status |
|----------+-------+-------+--------|
|          |       |       |        |

** TODO Step 4: i18n Review
:PROPERTIES:
:AGENT: workflow:reviewer
:STATUS: pending
:STARTED_AT:
:COMPLETED_AT:
:DEPENDS_ON: Step 3
:CONDITIONAL: has_user_facing_text
:END:

*** i18n Checklist
- [ ] No hardcoded user-facing strings
- [ ] Correct translation function used
- [ ] Language keys follow naming convention
- [ ] Pluralization handled where needed
- [ ] Parameters used for dynamic values
- [ ] All new keys added to language files

*** Hardcoded Strings Found
| File | Line | String | Suggested Key |
|------+------+--------+---------------|
|      |      |        |               |

*** New Language Keys Added
| Key | English Value |
|-----+---------------|
|     |               |

** TODO Step 5: Security Audit
:PROPERTIES:
:AGENT: workflow:security
:STATUS: pending
:STARTED_AT:
:COMPLETED_AT:
:DEPENDS_ON: Step 4
:ITERATION: 0
:MAX_ITERATIONS: 2
:END:

*** Security Checklist
- [ ] No injection vulnerabilities (SQL, command, XSS)
- [ ] Input validation present and tested for bypass
- [ ] Authentication/authorization correct
- [ ] Sensitive data protected
- [ ] No hardcoded secrets
- [ ] Dependencies secure

*** Security Findings
| Severity | Issue | File:Line | Remediation | Fixed |
|----------+-------+-----------+-------------+-------|
|          |       |           |             |       |

*** Security Notes
#+BEGIN_SRC markdown
(Security audit notes will be recorded here)
#+END_SRC

** TODO Step 6: Test Writing
:PROPERTIES:
:AGENT: workflow:test-writer
:STATUS: pending
:STARTED_AT:
:COMPLETED_AT:
:DEPENDS_ON: Step 5
:CONDITIONAL: tests_enabled
:END:

*** Test Objectives
- [ ] Unit tests for new functions/methods
- [ ] Integration tests if applicable
- [ ] Edge case coverage
- [ ] All tests passing

*** Tests Created
| Test File | Coverage | Status |
|-----------+----------+--------|
|           |          |        |

*** Test Results
#+BEGIN_SRC text
(Test output will be recorded here)
#+END_SRC

** TODO Step 7: Completion
:PROPERTIES:
:AGENT: workflow:completion-guard
:STATUS: pending
:STARTED_AT:
:COMPLETED_AT:
:DEPENDS_ON: Step 6
:END:

*** Final Checklist
- [ ] All steps completed
- [ ] All tests passing
- [ ] No security issues
- [ ] Code reviewed and approved
- [ ] Ready for commit

*** Commit Message
#+BEGIN_SRC text
(Suggested commit message)
#+END_SRC

* Completion Summary
:PROPERTIES:
:COMPLETED_AT:
:TOTAL_DURATION:
:END:

** Files Changed
| File | Lines Added | Lines Removed |
|------+-------------+---------------|
|      |             |               |

** Tests Added
-

** Review Iterations
- Code Review: X iterations
- Security Review: X iterations

** Notes
(Final notes and observations)

* Intervention Log
| Timestamp | Phase | User Instruction | Action Taken |
|-----------+-------+------------------+--------------|
|           |       |                  |              |
