#+TITLE: Refactor: {{TITLE}}
#+AUTHOR: Claude Code Workflow
#+DATE: {{DATE}}
#+PROPERTY: WORKFLOW_ID {{WORKFLOW_ID}}
#+PROPERTY: WORKFLOW_TYPE refactor
#+PROPERTY: STATUS active
#+PROPERTY: BRANCH {{BRANCH}}
#+PROPERTY: STATE_FILE {{STATE_FILE}}
#+PROPERTY: TESTS_ENABLED {{TESTS_ENABLED}}
#+PROPERTY: MODE {{MODE}}

* Overview
:PROPERTIES:
:CREATED_AT: {{TIMESTAMP}}
:UPDATED_AT: {{TIMESTAMP}}
:END:

** Refactoring Goal
{{DESCRIPTION}}

** Branch
- Branch: {{BRANCH}}
- Base: {{BASE_BRANCH}}

* Workflow Steps

** TODO Step 0: Analysis
:PROPERTIES:
:AGENT: Plan
:STATUS: pending
:STARTED_AT:
:COMPLETED_AT:
:END:

*** Objectives
- [ ] Understand current implementation
- [ ] Identify code smells / issues
- [ ] Design target architecture
- [ ] Plan incremental changes
- [ ] Identify risk areas

*** Analysis
#+BEGIN_SRC markdown
# Refactoring Analysis

## Current State
(Description of current implementation)

## Issues Identified
-

## Target State
(Description of desired implementation)

## Refactoring Steps
1.
2.
3.

## Risk Assessment
-
#+END_SRC

** TODO Step 1: Test Baseline
:PROPERTIES:
:AGENT: workflow:test-writer
:STATUS: pending
:STARTED_AT:
:COMPLETED_AT:
:DEPENDS_ON: Step 0
:END:

*** Objectives
- [ ] Ensure existing tests pass
- [ ] Add tests for untested code paths
- [ ] Establish baseline coverage
- [ ] Document current behavior

*** Baseline Test Results
#+BEGIN_SRC text
(Test output before refactoring)
#+END_SRC

*** Tests Added for Safety
| Test File | Purpose |
|-----------+---------|
|           |         |

** TODO Step 2: Implementation
:PROPERTIES:
:AGENT: workflow:executor
:STATUS: pending
:STARTED_AT:
:COMPLETED_AT:
:DEPENDS_ON: Step 1
:END:

*** Objectives
- [ ] Apply refactoring changes
- [ ] Maintain existing behavior
- [ ] Follow target architecture
- [ ] Keep changes atomic

*** Changed Files
| File | Action | Description |
|------+--------+-------------|
|      |        |             |

*** Refactoring Notes
#+BEGIN_SRC markdown
(Notes on changes made)
#+END_SRC

** TODO Step 3: Code Review
:PROPERTIES:
:AGENT: workflow:reviewer
:STATUS: pending
:STARTED_AT:
:COMPLETED_AT:
:DEPENDS_ON: Step 2
:ITERATION: 0
:MAX_ITERATIONS: 3
:END:

*** Review Criteria
- [ ] Behavior preserved
- [ ] Code quality improved
- [ ] Architecture goals met
- [ ] No new complexity introduced
- [ ] Tests still pass

*** Review Log
| Iteration | Verdict | Issues Found | Fixed |
|-----------+---------+--------------+-------|
|         1 |         |              |       |

*** Review Feedback
#+BEGIN_SRC markdown
(Review feedback)
#+END_SRC

** TODO Step 4: Test Validation
:PROPERTIES:
:AGENT: workflow:test-writer
:STATUS: pending
:STARTED_AT:
:COMPLETED_AT:
:DEPENDS_ON: Step 3
:END:

*** Objectives
- [ ] All existing tests pass
- [ ] Update tests if interfaces changed
- [ ] Verify behavior unchanged
- [ ] Check coverage maintained

*** Final Test Results
#+BEGIN_SRC text
(Test output after refactoring)
#+END_SRC

** TODO Step 5: Completion
:PROPERTIES:
:AGENT: workflow:completion-guard
:STATUS: pending
:STARTED_AT:
:COMPLETED_AT:
:DEPENDS_ON: Step 4
:END:

*** Final Checklist
- [ ] All tests pass
- [ ] Behavior unchanged
- [ ] Code quality improved
- [ ] Ready for commit

*** Commit Message
#+BEGIN_SRC text
refactor: <description>

- <what was changed>
- <why it was changed>
- <benefits of the change>
#+END_SRC

* Completion Summary
:PROPERTIES:
:COMPLETED_AT:
:TOTAL_DURATION:
:END:

** Before/After Comparison
** Quality Improvements
** Tests Updated
** Notes

* Intervention Log
| Timestamp | Phase | User Instruction | Action Taken |
|-----------+-------+------------------+--------------|
|           |       |                  |              |
